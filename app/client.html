<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="node_modules/moment/moment.js"></script>
    <script src="jquery.js"></script>
    <script>
window.$ = window.jQuery = require('./jquery.js');

$(function() {
  var wsUri = "ws://cabin.nyampass.com/ws";
  var $logtext = $('#log-text');
  var websocket;

  function startWebsocket() {
    websocket = new WebSocket(wsUri);
    websocket.onopen = function(evt) { onOpen(evt) };
    websocket.onclose = function(evt) { onClose(evt) };
    websocket.onmessage = function(evt) { onMessage(evt) };
    websocket.onerror = function(evt) { onError(evt) };
  }

  function onOpen(evt) {
    appendMessage("CONNECTED");
  }

  function onClose(evt) {
    appendMessage("DISCONNECTED");
  }

  function onMessage(evt) {
    appendMessage('RESPONSE: ' + evt.data);
  }

  function onError(evt) {
    appendMessage('ERROR: ' + evt.data);
  }

  function doSend(message) {
    appendMessage("SENT: " + message);
    websocket.send(message);
  }

  function appendMessage(message) {
    var datetime = moment().format('YYYY/MM/DD HH:mm:ss');
    var text = $logtext.val();
    $logtext.val(text + '[' + datetime + '] ' + message + '\n');
  }

  startWebsocket();
  var $input = $('#input');
  var $submit = $('#submit');

  $submit.click(function() {
    var message = $input.val();
    doSend(message);
  });
})
</script>
    <title>cabin</title>
    <body>
      <div class="container">
        <div class="menu-area">
        </div>
        <div class="content">
          <div class="editor">
            <textarea id="input"></textarea>
          </div>
          <div class="button-area">
            <div class="padd">
              <button id="submit" class="button">送信!</button>
            </div>
          </div>
        </div>
        <div class="log-area">
          <textarea id="log-text"></textarea>
        </div>
      </div>
    </body>
</html>
